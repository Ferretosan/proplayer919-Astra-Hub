<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Sand Tetris Enhanced</title><link href=https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css rel=stylesheet><style>@import url(https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap);body{background:linear-gradient(135deg,#1a1a1a,#2c2c2c);font-family:Orbitron,sans-serif;overflow:hidden}#game{box-shadow:0 0 20px rgba(255,255,255,.3);border-radius:8px}#preview{box-shadow:0 0 15px rgba(100,100,255,.5);border-radius:4px;background:#1a1a1a}.glow-text{text-shadow:0 0 10px rgba(255,255,255,.7)}.animate-pulse-slow{animation:pulse-slow 2s ease-in-out infinite}@keyframes pulse-slow{0%,100%{opacity:1}50%{opacity:.7}}#pause-menu{background:rgba(0,0,0,.85);backdrop-filter:blur(10px)}</style><body class="flex items-center flex-col justify-center min-h-screen text-white"><div class="flex items-center flex-col space-y-4"><h1 class="font-bold glow-text animate-pulse-slow text-5xl">Sand Tetris</h1><div class="flex items-center bg-gray-900 bg-opacity-80 justify-between p-4 rounded-lg shadow-lg w-[600px]"id=hud><div class=text-xl style=margin-right:1rem><span class=font-bold>Score:</span> <span class="ml-2 text-yellow-400"id=score>0</span></div><div class="flex items-center space-x-4"><button class="text-white duration-300 font-semibold py-2 rounded transition bg-blue-600 hover:bg-blue-700 px-4"id=music-toggle>Music: On</button> <button class="text-white duration-300 font-semibold py-2 rounded transition px-4 bg-green-600 hover:bg-green-700"id=pause-toggle>Pause</button></div><div class="flex items-center flex-col"style=margin-left:2rem><span class="font-bold text-lg">Next</span><canvas height=80 id=preview width=80></canvas></div></div><canvas height=400 id=game width=200 class=bg-gray-800></canvas><div class="font-bold glow-text text-3xl hidden mt-4 text-red-500"id=game-over>Game Over - Press R to Restart</div><div class="flex items-center justify-center fixed hidden inset-0 z-50"id=pause-menu><div class="bg-gray-900 rounded-lg p-8 shadow-xl space-y-4 text-center"><h2 class="font-bold glow-text text-3xl">Paused</h2><p class=text-lg>Press P or click Resume to continue</p><button class="text-white duration-300 font-semibold py-2 rounded transition bg-blue-600 hover:bg-blue-700 px-6"id=resume-button>Resume</button></div></div></div><audio id=bg-music loop><source src=https://cdn.pixabay.com/audio/2023/03/24/audio_9c8e1b2b8c.mp3 type=audio/mpeg></audio><script>const canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),previewCanvas=document.getElementById("preview"),previewCtx=previewCanvas.getContext("2d"),scoreEl=document.getElementById("score"),gameOverEl=document.getElementById("game-over"),musicToggle=document.getElementById("music-toggle"),pauseToggle=document.getElementById("pause-toggle"),pauseMenu=document.getElementById("pause-menu"),resumeButton=document.getElementById("resume-button"),bgMusic=document.getElementById("bg-music"),WIDTH=canvas.width,HEIGHT=canvas.height,GRID_SIZE=20,PARTICLE_SIZE=2,COLS=WIDTH/PARTICLE_SIZE,ROWS=HEIGHT/PARTICLE_SIZE;let score=0,isEliminating=!1,gameOver=!1,isPaused=!1,dropCounter=0;const dropInterval=500;let grid=Array.from({length:ROWS},(()=>new Array(COLS).fill(null)));const COLORS=["#facc15","#f87171","#60a5fa","#34d399","#c084fc"],shapes=[[[1,1,1],[0,1,0]],[[1,1],[1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1,1,1]]];function nextShape(){return{shape:shapes[Math.floor(Math.random()*shapes.length)],x:4,y:0,color:COLORS[Math.floor(Math.random()*COLORS.length)]}}let current=nextShape(),preview=nextShape();function rotateShape(){const e=Array(current.shape[0].length).fill().map((()=>Array(current.shape.length).fill(0)));for(let t=0;t<current.shape.length;t++)for(let r=0;r<current.shape[t].length;r++)e[r][current.shape.length-1-t]=current.shape[t][r];const t=current.shape;current.shape=e,checkCollision(0,0)||(current.shape=t)}function drawPreview(){previewCtx.clearRect(0,0,80,80);const e=12,t=(80-preview.shape[0].length*e)/2,r=(80-preview.shape.length*e)/2;for(let n=0;n<preview.shape.length;n++)for(let i=0;i<preview.shape[n].length;i++)preview.shape[n][i]&&(previewCtx.fillStyle=preview.color,previewCtx.fillRect(t+i*e,r+n*e,11,11),previewCtx.strokeStyle="rgba(255, 255, 255, 0.3)",previewCtx.strokeRect(t+i*e,r+n*e,11,11))}function drawParticle(e,t,r){ctx.fillStyle=r,ctx.fillRect(e*PARTICLE_SIZE,t*PARTICLE_SIZE,PARTICLE_SIZE,PARTICLE_SIZE)}function draw(){ctx.clearRect(0,0,WIDTH,HEIGHT);for(let e=0;e<ROWS;e++)for(let t=0;t<COLS;t++)grid[e][t]&&drawParticle(t,e,grid[e][t]);if(!isEliminating&&!gameOver&&!isPaused)for(let e=0;e<current.shape.length;e++)for(let t=0;t<current.shape[e].length;t++)if(current.shape[e][t])for(let r=0;r<GRID_SIZE/PARTICLE_SIZE;r++)for(let n=0;n<GRID_SIZE/PARTICLE_SIZE;n++)drawParticle((current.x+t)*(GRID_SIZE/PARTICLE_SIZE)+n,(current.y+e)*(GRID_SIZE/PARTICLE_SIZE)+r,current.color)}function floodFill(e,t,r,n){let i=[[e,t]],a=[];for(;i.length;){let[e,t]=i.pop();e<0||t<0||e>=COLS||t>=ROWS||n[t][e]||grid[t][e]!==r||(n[t][e]=!0,a.push([e,t]),i.push([e+1,t],[e-1,t],[e,t+1],[e,t-1]))}return a}function checkElimination(){isEliminating=!0;let e=Array.from({length:ROWS},(()=>Array(COLS).fill(!1))),t=[];for(let r=0;r<ROWS;r++)for(let n=0;n<COLS;n++)if(!e[r][n]&&grid[r][n]){let i=floodFill(n,r,grid[r][n],e);new Set(i.map((([e])=>e))).size===COLS&&t.push(...i)}if(t.length>0){let e=0,r=Math.max(...t.map((([e])=>e))),n=setInterval((()=>{for(let[r,n]of t)r===e&&(grid[n][r]=null);draw(),e++,e>r&&(clearInterval(n),score+=t.length,scoreEl.textContent=score,isEliminating=!1)}),10)}else isEliminating=!1}function updateParticles(){if(!(isEliminating||gameOver||isPaused))for(let e=ROWS-2;e>=0;e--)for(let t=0;t<COLS;t++)grid[e][t]&&!grid[e+1][t]?(grid[e+1][t]=grid[e][t],grid[e][t]=null):grid[e][t]&&(t>0&&!grid[e+1][t-1]?(grid[e+1][t-1]=grid[e][t],grid[e][t]=null):t<COLS-1&&!grid[e+1][t+1]&&(grid[e+1][t+1]=grid[e][t],grid[e][t]=null))}function checkCollision(e=0,t=0){for(let r=0;r<current.shape.length;r++)for(let n=0;n<current.shape[r].length;n++)if(current.shape[r][n])for(let i=0;i<GRID_SIZE/PARTICLE_SIZE;i++)for(let a=0;a<GRID_SIZE/PARTICLE_SIZE;a++){let l=(current.x+n+e)*(GRID_SIZE/PARTICLE_SIZE)+a,o=(current.y+r+t)*(GRID_SIZE/PARTICLE_SIZE)+i;if(l<0||l>=COLS||o>=ROWS||o>=0&&grid[o][l])return!1}return!0}function settlePiece(){for(let e=0;e<current.shape.length;e++)for(let t=0;t<current.shape[e].length;t++)if(current.shape[e][t])for(let r=0;r<GRID_SIZE/PARTICLE_SIZE;r++)for(let n=0;n<GRID_SIZE/PARTICLE_SIZE;n++){let i=(current.x+t)*(GRID_SIZE/PARTICLE_SIZE)+n,a=(current.y+e)*(GRID_SIZE/PARTICLE_SIZE)+r;i>=0&&i<COLS&&a>=0&&a<ROWS&&(grid[a][i]=current.color)}playFallSound(),spawnNewPiece(),playClearSound(),checkElimination()}function spawnNewPiece(){current=preview,preview=nextShape(),drawPreview(),checkCollision(0,0)||(gameOver=!0,gameOverEl.classList.remove("hidden"),bgMusic.pause())}function canMoveDown(){return checkCollision(0,1)}function playFallSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.type="square",t.frequency.value=300,t.connect(r),r.connect(e.destination),r.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.3),t.start(),t.stop(e.currentTime+.3)}function playClearSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.type="sine",t.frequency.setValueAtTime(600,e.currentTime),t.frequency.exponentialRampToValueAtTime(1200,e.currentTime+.3),t.connect(r),r.connect(e.destination),r.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.3),t.start(),t.stop(e.currentTime+.3)}function restartGame(){grid=Array.from({length:ROWS},(()=>new Array(COLS).fill(null))),score=0,gameOver=!1,isEliminating=!1,isPaused=!1,current=nextShape(),preview=nextShape(),scoreEl.textContent=score,gameOverEl.classList.add("hidden"),pauseMenu.classList.add("hidden"),bgMusic.paused||bgMusic.play(),drawPreview()}function togglePause(){isPaused=!isPaused,pauseMenu.classList.toggle("hidden"),pauseToggle.textContent=isPaused?"Resume":"Pause",isPaused?bgMusic.pause():musicToggle.textContent.includes("Off")||bgMusic.play()}function gameLoop(){isPaused||updateParticles(),gameOver||isEliminating||isPaused||(dropCounter+=16,dropCounter>500&&(canMoveDown()?current.y++:settlePiece(),dropCounter=0)),draw(),requestAnimationFrame(gameLoop)}bgMusic.volume=.5,musicToggle.addEventListener("click",(()=>{bgMusic.paused?(bgMusic.play(),musicToggle.textContent="Music: On"):(bgMusic.pause(),musicToggle.textContent="Music: Off")})),pauseToggle.addEventListener("click",togglePause),resumeButton.addEventListener("click",togglePause),document.addEventListener("keydown",(e=>gameOver&&"r"===e.key.toLowerCase()?restartGame():"p"!==e.key.toLowerCase()||gameOver?void(isEliminating||gameOver||isPaused||("ArrowLeft"===e.key&&checkCollision(-1,0)&&current.x--,"ArrowRight"===e.key&&checkCollision(1,0)&&current.x++,"ArrowDown"===e.key&&checkCollision(0,1)&&current.y++,"ArrowUp"===e.key&&rotateShape())):togglePause())),drawPreview(),bgMusic.play(),requestAnimationFrame(gameLoop);</script>